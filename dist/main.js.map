{"version":3,"file":"main.js","mappings":"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","sources":["webpack://instagram/./src/app/fileController.ts","webpack://instagram/./src/app/getRequestData.ts","webpack://instagram/./src/app/imageRouter.ts","webpack://instagram/./src/app/model.ts","webpack://instagram/./src/app/tagsController.ts","webpack://instagram/./src/app/tagsRouter.ts","webpack://instagram/external commonjs \"formidable\"","webpack://instagram/external commonjs \"http\"","webpack://instagram/external node-commonjs \"fs\"","webpack://instagram/webpack/bootstrap","webpack://instagram/webpack/runtime/compat get default export","webpack://instagram/webpack/runtime/define property getters","webpack://instagram/webpack/runtime/hasOwnProperty shorthand","webpack://instagram/webpack/runtime/make namespace object","webpack://instagram/./src/index.ts"],"sourcesContent":["import * as formidable from 'formidable';\nimport * as fs from 'fs';\nimport { nextPhotoId, photoList } from './model';\n\nclass FileControllerClass\n{\n\ncreateAlbum(name: string): void\n{\n    fs.mkdirSync(`./albums/${name}`)\n}\n\nuploadPhoto(name: string, album: string)\n{\n    if(!fs.existsSync(`./albums/${album}`))\n        this.createAlbum(album)\n    fs.renameSync(`./temp/${name}`, `./albums/${album}/${name}`)\n    photoList.push({\n        id: nextPhotoId.id as unknown as number,\n        album: album,\n        originalName: name,\n        url: `./albums/${album}/${name}`,\n        lastChange: Date.now().toLocaleString(),\n        history: [],\n        tagList: []\n    })\n    nextPhotoId.id += 1\n    return photoList[photoList.length - 1]\n}\n\nfindPhotoById(id: number)\n{\n    return photoList.find(el => el.id == id)\n}\n\n}\nconst FileController = new FileControllerClass()\nexport default FileController\n\n// export interface PhotoData {\n//     id: String,\n//     album: String,\n//     originalName: String,\n//     url: String,\n//     lastChange: String,\n//     history: singleChange[]\n// }","import { IncomingMessage } from \"http\";\r\n\r\nexport async function getPostData(req: IncomingMessage):Promise<string>\r\n{\r\n    return new Promise((resolve, reject) =>{\r\n        try {\r\n            let body = \"\"\r\n\r\n            req.on(\"data\", part => {\r\n                body += part.toString()\r\n            })\r\n    \r\n            req.on(\"end\", () => {\r\n                resolve(body)\r\n            })\r\n    \r\n        }\r\n        catch (err)\r\n        {\r\n            reject(err)\r\n        }\r\n        \r\n    })\r\n}","import * as formidable from \"formidable\";\nimport { IncomingMessage, ServerResponse } from \"http\";\nimport FileController from \"./fileController\";\nimport { getPostData } from \"./getRequestData\";\nimport { photoList } from \"./model\";\n\nexport default async function imageRouter(\n  req: IncomingMessage,\n  res: ServerResponse\n) {\n  switch (req.method) {\n    case \"GET\":\n      const [path, params] = req.url.split(/\\?/);\n      if (path == \"/api/photos\") {\n        res.statusCode = 200;\n        res.setHeader(\"content-type\", \"application/json\");\n\n        res.end(JSON.stringify(photoList))\n        //pobierz wszystkie\n        res.end();\n      } else if (req.url.match(/api\\/photos\\/[0-9]*/)) {\n        res.statusCode = 200;\n        res.setHeader(\"content-type\", \"image/jpg\");\n        //pobierz jedno zdjęcie\n        res.end();\n      }\n      break;\n    case \"POST\":\n      if (req.url == \"/api/photos\") {\n        const form = formidable({ multiples: true, uploadDir: \"./temp\" });\n        form.parse(req, (err, fields, files) => {\n          if (err) {\n            res.statusCode = err.httpCode || 404;\n            res.statusMessage = String(err);\n            res.end();\n            return;\n          }\n\n          const photo = FileController.uploadPhoto((files.file as unknown as formidable.File).newFilename, (fields as unknown as{album: string}).album)\n          res.statusCode = 200;\n          res.setHeader(\"content-type\", \"application/json\");\n          res.end(JSON.stringify({ ok: \"ok\", ...photo }));\n        });\n      }\n      break;\n    case \"DELETE\":\n      if (req.url.match(/api\\/photos\\/[0-9a-zA-Z]*/)) {\n        res.statusCode = 200;\n        res.setHeader(\"content-type\", \"application/json\");\n\n        //usun zdjecie i zwroc jego json\n        res.end();\n      }\n      break;\n    case \"PATCH\":\n      if (req.url.match(/api\\/photos\\/[0-9]*/)) {\n        res.statusCode = 200;\n        res.setHeader(\"content-type\", \"application/json\");\n        const body = await getPostData(req)\n        //edytuj jedno zdjecie\n        res.end(JSON.stringify(body));\n      }\n      break;\n  }\n}\n","interface singleChange \n{\n    status: string,\n    lastModifiedDate: string\n}\n\nexport interface PhotoData {\n    id: number,\n    album: string,\n    originalName: string,\n    url: string,\n    lastChange: string,\n    history: singleChange[],\n    tagList: string[]\n}\n\nexport interface TagData {\n    id: number,\n    name: string,\n    popularity:number\n}\n\nexport interface UpdatePhotoTagsData {\n    photoId: number,\n    tagName: string | string[],\n\n}\nexport const tagsList:TagData[] = [\n    {\n        \"id\": 0,\n        \"name\": \"#love\",\n        \"popularity\": 0\n   },\n   {\n        \"id\": 1,\n        \"name\": \"#instagood\",\n        \"popularity\": 0\n   },\n   {\n        \"id\": 2,\n        \"name\": \"#fashion\",\n        \"popularity\": 0\n   },\n   {\n        \"id\": 3,\n        \"name\": \"#photooftheday\",\n        \"popularity\": 0\n   },\n   {\n        \"id\": 4,\n        \"name\": \"#beautiful\",\n        \"popularity\": 0\n   },\n   {\n        \"id\": 5,\n        \"name\": \"#art\",\n        \"popularity\": 0\n   }\n]\nexport let nextTagId = {\n    _id:6,\n    get id()\n    {\n        return this._id\n\n    },\n    set id(value: number)\n    {\n        this._id = value\n    }\n}\n\nexport const photoList:PhotoData[] = []\nexport let nextPhotoId = \n{\n    _id: 0,\n    get id()\n    {\n        return this._id\n    },\n    set id(value:number)\n    { this._id = value}\n\n}\n","import { tagsList, nextTagId, photoList } from \"./model\";\r\n\r\nexport function addTag(name:string, popularity?: number):boolean\r\n{\r\n    if(tagsList.findIndex(tag => tag.name == name) == -1)\r\n    {\r\n        tagsList.push({\r\n            name: name,\r\n            popularity: popularity ?? 0,\r\n            id: nextTagId.id\r\n        })\r\n        nextTagId.id += 1\r\n      return true\r\n    }\r\n   return false;\r\n}\r\n\r\nexport function bindTag(photoId:number, tagId:number[]):boolean\r\n{\r\n  let success = true;\r\n  const photo = photoList.find(photo => photo.id == photoId)\r\n\r\n  \r\n    tagId.forEach(id => {\r\n      const tag = tagsList.find(tag => tag.id == id)\r\n      if(tag !== undefined && !photo.tagList.includes(tag.name))\r\n        photo.tagList.push(tag.name)\r\n      else\r\n      success = false\r\n    })\r\n  \r\n\r\n  return success;\r\n}","import { IncomingMessage, ServerResponse } from \"http\";\r\nimport { url } from \"inspector\";\r\nimport { getPostData } from \"./getRequestData\";\r\nimport { photoList, tagsList, UpdatePhotoTagsData } from \"./model\";\r\nimport { addTag, bindTag } from \"./tagsController\";\r\n\r\nexport default async function tagRouter(\r\n  req: IncomingMessage,\r\n  res: ServerResponse<IncomingMessage>\r\n) {\r\n  switch (req.method) {\r\n    case \"GET\":\r\n      const [path, args] = req.url.split(\"?\");\r\n      console.log(path)\r\n      if (path.match(/raw/)) {\r\n        res.statusCode = 200;\r\n        res.statusMessage = \"ok\";\r\n        res.setHeader(\"content-type\", \"application/json\");\r\n\r\n        const stringList = tagsList.map((tag) => {\r\n          return tag.name;\r\n        });\r\n        res.write(JSON.stringify(stringList));\r\n        res.end();\r\n      } else if (path.match(/tags$/)) {\r\n        res.statusCode = 200;\r\n        res.statusMessage = \"ok\";\r\n        res.setHeader(\"content-type\", \"application/json\");\r\n        res.write(JSON.stringify(tagsList));\r\n        res.end();\r\n      } else if (path.match(/tags\\/[0-9]*/)) {\r\n        \r\n        const id = path.split(/\\/tags\\//)[1] as unknown as number;\r\n        const photo = photoList.find(photo => photo.id == id)\r\n        if(photo === undefined)\r\n        {\r\n          res.statusMessage = \"I'm not ok\"\r\n          res.statusCode = 403\r\n          res.end()\r\n          return;\r\n        }\r\n\r\n\r\n        \r\n        const tag = photo.tagList.map(\r\n          name => {\r\n           const tag =  tagsList.find((tag) => tag.name == name);\r\n           if(tag !== undefined)\r\n           return tag\r\n          }\r\n        )\r\n        \r\n        \r\n\r\n        res.statusCode = 200;\r\n        res.statusMessage = \"ok\";\r\n        res.setHeader(\"content-type\", \"application/json\");\r\n        res.write(JSON.stringify(tag));\r\n        res.end();\r\n      }\r\n      break;\r\n\r\n    case \"POST\":\r\n      if (req.url.match(/^\\/api\\/tags$/)) {\r\n        getPostData(req).then((body) => {\r\n          console.log(body)\r\n          const obj = JSON.parse(body) as {name: string, popularity?: number}\r\n          obj.name = \"#\" + obj.name.replace(/\\#/g, \"\")\r\n\r\n          console.log(obj)\r\n\r\n          const ok = addTag(obj.name, obj.popularity)\r\n          if(ok){\r\n            res.statusCode = 200\r\n            res.statusMessage = \"ok\"\r\n            res.end()\r\n          }\r\n          else{\r\n            res.statusCode = 400\r\n            res.statusMessage = \"this tag probably already exists\"\r\n            res.end()\r\n          }\r\n        });\r\n      }\r\n      break;\r\n\r\n    case \"PATCH\":\r\n        if(req.url.match(/api\\/photos\\/tags$/))\r\n        {\r\n            const body:string = await getPostData(req) as string;\r\n            const obj = JSON.parse(body) as UpdatePhotoTagsData\r\n            obj.tagName = \"#\" + (obj.tagName as string).replace(/\\#/g, \"\")\r\n            const tagId = tagsList.find(tag => tag.name == obj.tagName).id \r\n            if(bindTag(obj.photoId, [tagId]))\r\n            {\r\n              res.statusMessage = \"ok\"\r\n              res.statusCode = 200\r\n            }\r\n            else\r\n            {\r\n              res.statusMessage = \"I'm not ok\"\r\n              res.statusCode = 403\r\n            }\r\n            res.end()  \r\n        }\r\n        else if(req.url.match(/api\\/photos\\/tags\\/mass$/))\r\n        {\r\n          const body:string = await getPostData(req) as string;\r\n          const obj = JSON.parse(body) as UpdatePhotoTagsData\r\n          \r\n          const tagId = (obj.tagName as string[]).map(name => {\r\n            const tag = tagsList.find(el => name == el.name)\r\n            if(tag !== undefined)\r\n              return tag.id;\r\n          });\r\n\r\n          if(bindTag(obj.photoId, tagId))\r\n            {\r\n              res.statusMessage = \"ok\"\r\n              res.statusCode = 200\r\n            }\r\n            else\r\n            {\r\n              res.statusMessage = \"I'm not ok\"\r\n              res.statusCode = 403\r\n            }\r\n            res.end()  \r\n          \r\n          \r\n        break;\r\n          }\r\n  }\r\n  return;\r\n}\r\n","module.exports = require(\"formidable\");","module.exports = require(\"http\");","module.exports = require(\"fs\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { createServer } from \"http\";\nconst PORT = 3000;\nimport imageRouter from \"./app/imageRouter\";\nimport tagRouter from \"./app/tagsRouter\";\n\nconst server = createServer((req, res) => {\n\n  if(req.url.match(/tags/))\n    tagRouter(req, res);\n  else if(req.url.match(/\\/api\\/photos/))\n    imageRouter(req, res);\n\n});\n\nserver.listen(PORT, () => {\n  console.log(\"Start on \" + PORT);\n});\n"],"names":[],"sourceRoot":""}